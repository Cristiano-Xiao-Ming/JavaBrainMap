# 系统架构相关

## 系统双写解决方案

### 系统双写、多写的概念

- 一般来讲是指系统业务需要将业务数据保存到多个数据源当中，比如一条用户信息的数据需要同时存储到 MySQL 数据库，ElasticSearch 存储引擎，Redis 缓存，HDFS 等。

### 双写的缺点

- 一致性问题

	- 并发情况下向多个数据源写入数据就会发生数据混乱

- 原子性问题

	- 比如有两个数据源需要写入数据，那么就需要保证这两个数据源同时写入成功，或者同时失败，不能一个成功，一个失败的现象发生，类似于数据库的事务原子性概念。

### 双写的解决方案

- 按顺序记录数据的变更

	- 消息队列

		- 将数据按顺序记录，写入某个消息队列，然后其他系统按消息顺序恢复数据
		- 所有的数据变更写入一个消息队列里去。其他各数据源从消息队列里恢复数据即可
		- 缺点

			- 一般不符合「写后即读」的系统要求，通常在实际的业务中，我们要求数据库的更新与查询应该都是最新最及时的。

- 其他存储源提取数据库的数据变更

	- 客户端请求
应用程序
Database
中间件（监控数据的变化）
变化的数据写入消息队列
Redis、ES、HDFS 等数据源消费队列中变更的数据
	- 将数据库作为应用的单一存储源，其余的存储源监控数据库的数据变化来对自己进行更新，从而实现双写的高可用性。

## 分支主题 2

## 分支主题 3

